---
weight: 5
---

# Pre-installation Configuration

## **Setting Default Storage Class**

Before deploying Alauda AI, you need to set the default storage class for the cluster.

1. Log in to the Web Console as an administrator.
2. Switch to the **Administrator** view.
3. Click **Storage** > **StorageClasses**.
4. Click **Create StorageClass** to deploy a storage class, e.g., TopoLVM. If the desired storage class is already deployed, skip this step.
5. Select the storage class to set as default,and click **Set Default**.

## **Deploy Service Mesh**

Since Alauda AI leverages Service Mesh capabilities for model inference services, Service Mesh must be deployed in the cluster before deploying Alauda AI. For detailed deployment procedures, refer to <ExternalSiteLink name="servicemesh" href="/install/create_service_mesh/index.mdx" children="Create Service Mesh" />.

:::info

After completing the **Prerequisites** on the **Create Service Mesh** page, proceed to the **Creating a Service Mesh** page and follow the on-screen instructions to finalize the deployment of the Service Mesh.

:::

## **Preparing the GitLab Service**

In Alauda AI, GitLab is the core component for **Model Management**. Before deploying Alauda AI, you **must prepare** a GitLab service.

### **Deployment Options**

#### **1. GitLab service requirements**

Regardless of deployment method, all GitLab instances must satisfy:

- **Version**: Must be **v15 or later**.
- **Protocol**: Must use **HTTPS**.
- **Git LFS**: Must be **enabled**. For setup instructions, refer to <ExternalSiteLink name="alauda-build-of-gitlab" href="/howto/01_lfs.mdx" children="Managing Large Files with LFS" />.
- **Hosting**: Must be **self-hosted** (public cloud-hosted GitLab services are **not supported**).
- **Access Tokens**: **Disable expiration dates** for access tokens.

#### **2. Use the platform-provided plugin**

Deploy a new GitLab service using the **'Alauda Build of GitLab'** plugin.
For instructions, refer to: <ExternalSiteLink name="alauda-build-of-gitlab" href="/install/01_installation_guide.mdx" children="Deploy Alauda Build of GitLab" />.

#### **3. Use your own GitLab service**

Alternatively, you can use a **self-managed GitLab instance**, but it **must meet** the **GitLab service requirements**.

### **GitLab Configuration**

Before deploying Alauda AI, perform these GitLab configuration steps after service acquisitionã€‚

#### **1. Disable expiration dates for access tokens**

If GitLab is running `v17.0` or greater, we need to **disable** expiration dates for access tokens.

:::warning

If expiration date for access token keeps enabled, we have to refresh admin token manually at least yearly, or Alauda AI may stop functionally.

:::

To **disable** expiration dates for new access tokens:

1. On the left sidebar, at the bottom, select **Admin**.
2. Select **Settings > General**.
3. Expand **Account and limit**.
4. **Uncheck** the **Personal / Project / Group access token expiration** checkbox.
5. Select **Save changes**.

#### **2. Generate new token**

To **generate** impersonation token for admin:

1. On the left sidebar, at the bottom, select **Admin**.
2. Select **Overview > Users**.
3. Select the admin user (Administrator for example).
4. On the top navigation bar, select **Impersonation Tokens**.
5. Select **Add new token**.
6. In the popup form:
   1. Input a **Token name** for Alauda AI (`aml-root`, for example).
   2. Remove **Expiration Date** (select "x" icon to remove expiration date).
   3. Check **ALL** scopes (especially **api** scope) for **Select scopes**.
7. Select **Create impersonation token**.
8. **Save** the newly generated token under **Your new impersonation token**, we need to use it later.

:::warning

Make sure you save the newly generate token - you won't be able to access it again.

:::

#### **3. Create kubernetes secret for admin token**

Then we create secret for gitlab admin token named **aml-gitlab-admin-token** under **cpaas-system** namespace:

```bash
# [!code highlight]
# Please replace ${TOKEN} with real token saved previously
# [!code callout:3]
kubectl create secret generic aml-gitlab-admin-token \
  --from-literal="password=${TOKEN}" \
  -n cpaas-system
```

<Callouts>

1. Create a gitlab admin token secret named **aml-gitlab-admin-token**
2. The token is saved under **password** key, please replace `${TOKEN}` with the real token saved previously.
3. The secret is created under **cpaas-system** namespace.

</Callouts>