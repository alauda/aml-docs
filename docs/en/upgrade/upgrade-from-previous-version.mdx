---
weight: 10
---

export const prevVersion = '1.5'
export const curVer = '2.0'

# Upgrade Alauda AI

:::info
Upgrade from {prevVersion} to {curVer}
:::

## Install Alauda AI Cluster Components

Please visit [Alauda AI Cluster](../installation/ai-cluster.mdx) for:

:::warning
Please ignore `Creating Alauda AI Cluster Instance` since we are upgrading **Alauda AI** from a previously managed version.
:::

1. [Downloading](../installation/ai-cluster.mdx#downloading) operator bundle packages for `Alauda AI Cluster` and `KServeless`.
2. [Uploading](../installation/ai-cluster.mdx#uploading) operator bundle packages to the destination cluster.
3. To upgrade, follow the process described below.

## Pre-Upgrade Operations

### Annotating Stopped Inference Services

Starting from version {curVer}, the platform adopts the community-native stop capability provided by KServe. To ensure a smooth upgrade, all inference services that are currently in a **stopped** state must be explicitly annotated before upgrading.

:::warning
This step is **required** before upgrading. Failure to annotate stopped inference services may result in unexpected behavior after the upgrade.
:::

1. List all inference services that are currently stopped:

   ```bash
   kubectl get inferenceservices --all-namespaces
   ```

2. For each stopped inference service, add the following annotation:

   ```bash
   kubectl annotate inferenceservice <name> -n <namespace> serving.kserve.io/stop='true'
   ```

   Alternatively, you can edit the resource directly and add the annotation under `metadata.annotations`:

   ```yaml
   apiVersion: serving.kserve.io/v1beta1
   kind: InferenceService
   metadata:
     name: <name>
     annotations:
       serving.kserve.io/stop: 'true' #[!code highlight]
   ```

3. Repeat this step for all stopped inference services across all namespaces.

## Upgrading

The following procedure describes how to upgrade from **Alauda AI** {prevVersion} to {curVer}.

### Upgrade Alauda AI Essentials

Upgrade **Alauda AI Essentials** in the Functional Components tab of the global cluster.

In the **Administrator** view, navigate to **Clusters / Cluster** in the left navigation, find the **global** cluster in the right panel, and click the **Upgrade** button on the **Functional Components** tab page to trigger the upgrade.

:::info
All components that require upgrading, including **Alauda AI Essentials**, will be upgraded together and cannot be upgraded individually.
:::

After the upgrade is complete, please confirm that the status of **Alauda AI Essentials** in the list is **Running** and the version is **v{curVer}.x**.

### Upgrading Alauda AI Operators

The procedure for upgrading both operators is nearly identical, with only the target component being different.

| Step            | Alauda AI Operator                                                                                | Alauda AI Model Serving Operator                                                                  |
|:----------------|:--------------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------|
| **1. Navigate** | Log into the Web Console, then go to **Marketplace > OperatorHub** in the **Administrator** view. | Log into the Web Console, then go to **Marketplace > OperatorHub** in the **Administrator** view. |
| **2. Select**   | Select your target **cluster**.                                                                   | Select your target **cluster**.                                                                   |
| **3. Click**    | Click the **Alauda AI** card.                                                                     | Click the **Alauda AI Model Serving** card.                                                       |
| **4. Confirm**  | Click **Confirm** on the upgrade prompt.                                                          | Click **Confirm** on the upgrade prompt.                                                          |

:::info
Once the new version is uploaded and recognized by the platform, an upgrade prompt will appear at the top of the operator's page.
:::

### Upgrading Cluster Plugins

:::info
This step is **only required if you have deployed** any of the following cluster plugins: **Alauda AI Workbench**, **Alauda AI MLflow**, or **Alauda AI Volcano**. If you have not deployed any of these plugins, you can skip this step.

For more information about cluster plugins, refer to <ExternalSiteLink name="acp" href="extend/index.html" children="Alauda Container Platform - Extend" />.
:::

The procedure to upgrade cluster plugins involves uploading new version packages and then upgrading them from the Web Console. The following plugins require upgrading:

- Alauda AI Workbench
- Alauda AI MLflow
- Alauda AI Volcano

#### Uploading Cluster Plugins

Upload the new cluster plugin packages to the global cluster. For detailed instructions on how to upload cluster plugins, refer to <ExternalSiteLink name="acp" href="extend/upload_package.html#upload-a-cluster-plugin" children="Uploading Cluster Plugins" />.

Repeat the upload process for each plugin that you have deployed.

:::info
After the upload is completed, wait approximately 10–15 minutes for the platform to synchronize the new version information.
:::

#### Verifying the New Version

Navigate to **Administrator > Marketplace > Upload Packages** and switch to the **Cluster Plugin** tab. Locate each uploaded plugin to verify that the new version is displayed.

#### Upgrading from Web Console

1. Navigate to **Administrator > Clusters > Clusters**.
2. Click on the cluster where the plugins are deployed.
3. Switch to the **Functional Components** tab in the cluster details page.
4. Locate the cluster plugins that have available upgrades—an upgrade icon will be displayed next to them.
5. Click the **Upgrade** button for the plugin you want to upgrade.
6. Review the upgrade information in the popup window, confirm the plugin version to be upgraded, and click the **Upgrade** button to start the upgrade process.

Repeat this process for each plugin that you have deployed.

:::info
Once the new version is uploaded and recognized by the platform, the **Upgrade** button will become available for each plugin on the **Features** tab of the cluster details page.
:::

## Post-Upgrade Operations

### Updating Existing Inference Services

Due to breaking changes in KServe's product mode definition and the `InferenceService` resource introduced in version {curVer}, all inference services that existed **before the upgrade** must be manually updated.

:::warning
This step is **required** for all pre-existing inference services. Failure to perform this update may cause inference services to behave unexpectedly.
:::

For each existing inference service, perform the following steps:

1. Navigate to the inference service details page.
2. Click **Update Inference Service**.
3. In the update page, click the **YAML** toggle button in the upper-right corner to switch to the YAML view.
4. Locate the `spec.predictor.model.name` field.
5. Delete the `name` field and its value entirely.

   For example, if the YAML contains:

   ```yaml
   spec:
     predictor:
       model:
         name: kserve-container  #[!code --]
         modelFormat:
           name: sklearn
   ```

   After deletion, it should look like:

   ```yaml
   spec:
     predictor:
       model:
         modelFormat:
           name: sklearn
   ```

6. Click **Save** to apply the changes.
7. Repeat this process for all inference services that existed before the upgrade.

## Verification

<Steps>
### Alauda AI
Check the status field from the `AmlCluster` resource which named `default`:

```bash
kubectl get amlcluster default
```

Should returns `Ready`:

```
NAME      READY   REASON
default   True    Succeeded
```

### Alauda AI Model Serving

Check the status field from the `KnativeServing` resource which named `default-knative-serving`:

```bash
kubectl get KnativeServing.components.aml.dev default-knative-serving
```

Should returns `InstallSuccessful`:

```
NAME                      DEPLOYED   REASON
default-knative-serving   True       UpgradeSuccessful
```

### Alauda AI Cluster Plugins

In the **Administrator** view, navigate to **Marketplace > Cluster Plugins** and confirm that the following cluster plugins show `Installed` status with the new version:

- Alauda AI Workbench (if deployed)
- Alauda AI MLflow (if deployed)
- Alauda AI Volcano (if deployed)

</Steps>
