---
weight: 5
sourceSHA: 4ca7438fcd143e37804758166e5ae760f0cee0a571ff0509169d917badb55511
---

# 预配置

## GitLab 配置

### 禁用访问令牌的过期日期

如果 GitLab 版本为 v17.0 或更高，我们需要**禁用**访问令牌的过期日期。

:::warning

如果访问令牌的过期日期仍然启用，我们必须至少每年手动刷新一次管理令牌，否则 Alauda AI 可能会停止功能。

:::

要**禁用**新访问令牌的过期日期：

1. 在左侧边栏底部，选择 **Admin**（管理员）。
2. 选择 **Settings > General**（设置 > 一般）。
3. 展开 **Account and limit**（账户和限制）。
4. **取消选中** **Personal / Project / Group access token expiration**（个人/项目/组访问令牌过期）复选框。
5. 选择 **Save changes**（保存更改）。

### 生成新令牌

要为管理员**生成**模拟令牌：

1. 在左侧边栏底部，选择 **Admin**（管理员）。
2. 选择 **Overview > Users**（概述 > 用户）。
3. 选择管理员用户（例如 Administrator）。
4. 在顶部导航栏中，选择 **Impersonation Tokens**（模拟令牌）。
5. 选择 **Add new token**（添加新令牌）。
6. 在弹出表单中：
   1. 输入一个 **Token name**（令牌名称）用于 Alauda AI（例如 `aml-root`）。
   2. 移除 **Expiration Date**（过期日期）（选择 "x" 图标以移除过期日期）。
   3. 勾选 **ALL** 范围（特别是 **api** 范围）作为 **Select scopes**（选择作用域）。
7. 选择 **Create impersonation token**（创建模拟令牌）。
8. **保存** 新生成的令牌，在 **Your new impersonation token**（您的新模拟令牌）下，我们需要稍后使用它。

:::warning

确保保存新生成的令牌 - 之后将无法再次访问它。

:::

### 为管理员令牌创建 Kubernetes 密钥

然后我们在 **cpaas-system** 命名空间下为 GitLab 管理令牌创建名为 **aml-gitlab-admin-token** 的密钥：

```bash
# 请将 ${TOKEN} 替换为之前保存的真实令牌
kubectl \
  create secret generic \
  aml-gitlab-admin-token \   # [!code callout]
  --from-literal="password=${TOKEN}" \   # [!code callout]
  -n cpaas-system   # [!code callout]
```

<Callouts>
  1. 创建一个名为 **aml-gitlab-admin-token** 的 GitLab 管理令牌密钥。
  2. 该令牌在 **password** 键下保存，请将 `${TOKEN}` 替换为之前保存的真实令牌。
  3. 密钥是在 **cpaas-system** 命名空间下创建的。
</Callouts>
