---
weight: 10
sourceSHA: a93f1b24935100b96ac2659af9a5379d619c98d6f062d0513b12c48a0a63d62c
---

# Введение в функцию

Основное определение функции службы вывода заключается в развертывании обученных моделей машинного или глубокого обучения как онлайн-сервисов, доступных для вызова, с использованием таких протоколов, как HTTP API или gRPC, что позволяет приложениям использовать предсказания, классификации, генерации и другие функции модели в реальном времени или пакетном режиме. Эта функция в основном решает, как эффективно, стабильно и удобно развернуть модели в производственной среде после завершения обучения модели и предоставить масштабируемые онлайн-сервисы.

## Преимущества

- Упрощает процесс развертывания модели, снижая сложность развертывания.
- Обеспечивает высокую доступность и высокую производительность онлайн- и пакетных сервисов вывода.
- Поддерживает динамическое обновление моделей и управление версиями.
- Реализует автоматизированную эксплуатацию, обслуживание и мониторинг услуг вывода моделей.

## Применимые сценарии

- Системы рекомендаций в реальном времени: рекомендации товаров или контента на основе поведения пользователя.
- Распознавание изображений: классификация, обнаружение или распознавание загруженных изображений.
- Обработка естественного языка: предоставляет такие услуги, как классификация текста, анализ настроений и машинный перевод.
- Контроль финансовых рисков: оценка кредитного риска пользователя или риска транзакции в реальном времени.
- Сервисы больших языковых моделей: предоставление онлайн-вопросов и ответов, генерации текста и других услуг.
- Пакетный вывод: извлечение большого объема данных в режиме не реального времени, таких как анализ исторических данных и генерация отчетов.

## Принесенная ценность

- Ускоряет развертывание моделей и сокращает циклы разработки приложений.
- Улучшает эффективность вывода модели и снижает задержки.
- Снижает затраты на эксплуатацию и обслуживание, улучшает стабильность системы.
- Поддерживает быструю итерацию и инновации бизнеса.

## Основные функции

**Прямое развертывание модели для выводных служб**

- Позволяет пользователям напрямую выбирать определенные версии файлов модели из репозитория моделей и указывать изображение времени выполнения вывода для быстрого развертывания онлайн-служб вывода. Система автоматически загружает, кеширует и загружает модель, начиная службу вывода. Это упрощает процесс развертывания модели и снижает порог развертывания.

**Развертывание пользовательского изображения для выводных служб**

- Поддерживает пользователей в написании Dockerfile для упаковки моделей и их зависимостей в пользовательские образы, а затем развертывает службы вывода через стандартные развертывания Kubernetes. Этот подход предоставляет большую гибкость, позволяя пользователям настраивать среду вывода в соответствии с их потребностями.

**Пакетные операции выводных служб**

- Поддерживает пакетные операции для нескольких служб вывода, такие как массовый запуск, остановка, обновление и удаление.
- Способен поддерживать создание, мониторинг и экспорт результатов пакетных задач вывода.
- Предоставляет управление ресурсами пакетов, которое может выделять и корректировать ресурсы служб вывода партиями.

**Опыт службы вывода**

- Предоставляет интерактивный интерфейс для облегчения тестирования и взаимодействия пользователей со службами вывода.
- Поддерживает несколько форматов ввода и вывода для удовлетворения потребностей различных сценариев применения.
- Предоставляет инструменты оценки производительности модели, чтобы помочь пользователям оптимизировать развертывание модели.

**Поддержка времени выполнения вывода**

- Интегрирует разнообразные основные фреймворки вывода, такие как vLLM, Seldon MLServer и т. д., и поддерживает пользовательские определения временных интервалов вывода.

:::tip

- vLLM: оптимизирован для больших языковых моделей (LLMs), таких как DeepSeek/Qwen, обеспечивая высокую пропускную способность и улучшенную производительность с превосходной эффективностью использования ресурсов.
- MLServer: предназначен для традиционных моделей ML (XGBoost/классификация изображений), предлагая многоплатформенную совместимость и упрощенное отладка.

:::

**Методы доступа, журналы, Swagger, мониторинг и т. д.**

- Предоставляет несколько методов доступа, таких как HTTP API и gRPC.
- Поддерживает детальное ведение журналов и анализ для облегчения устранения неполадок пользователями.
- Автоматически генерирует документацию Swagger для облегчения интеграции пользователей и вызова служб вывода.
- Предоставляет функции мониторинга в реальном времени и сигнализации для обеспечения стабильной работы сервиса.

# Преимущества функции

**Преимущества производительности:**

- Поддерживает аппаратное ускорение GPU для повышения скорости вывода модели.
- Поддерживает пакетный вывод для повышения пропускной способности.
- Оптимизирует среду выполнения вывода, чтобы уменьшить задержки.

**Масштабируемость:**

- Построен на Kubernetes, поддерживает эластичное масштабирование.
- Поддерживает горизонтальное масштабирование для обработки сценариев высокой конкурентоспособности.
- Поддерживает распределенный вывод больших моделей.
- Поддерживает параллельную обработку пакетных задач.

**Безопасность:**

- Предоставляет механизмы аутентификации и авторизации для обеспечения безопасности сервиса.
- Поддерживает сетевую изоляцию для предотвращения утечки данных.
- Поддерживает безопасное развертывание и обновление моделей.

**Стабильность:**

- Предоставляет проверки состояния и механизмы автоматического перезапуска для повышения доступности сервиса.
- Поддерживает мониторинг журналов и сигналы тревоги для своевременного выявления и решения проблем.

## Создание службы вывода

<Steps>
  ### Шаг 1

  **Выберите пользовательскую публикацию**

  :::tip
  Публикация пользовательской службы вывода требует ручной настройки параметров. Вы также можете создать «шаблон», комбинируя входные параметры для быстрого развертывания служб вывода.
  :::

  ### Шаг 2

  **Укажите детали службы вывода для публикации модели**

  | Параметры             | Описание                                                                                                                |
  | :--------------------- | :------------------------------------------------------------------------------------------------------------------------- |
  | Имя                   | Обязательно, имя API вывода.                                                                                   |
  | Описание            | Подробное описание API вывода, объясняющее его функциональность и назначение.                                     |
  | Модель                  | Обязательно, имя модели, используемой для вывода.                                                                        |
  | Версия                | Обязательно, версия модели. варианты включают ветвь и тег.                                                        |
  | Временные размеры вывода     | Обязательно, движок, используемый для времени выполнения вывода                                                                            |
  | Запрашиваемый CPU           | Обязательно, количество запрашиваемых ресурсов CPU для службы вывода.                                                  |
  | Запрашиваемая память        | Обязательно, количество запрашиваемых ресурсов памяти для службы вывода.                                               |
  | Ограничения CPU             | Обязательно, максимальное количество ресурсов CPU, которые может использовать служба вывода.                                          |
  | Ограничения памяти          | Обязательно, максимальное количество ресурсов памяти, которые может использовать служба вывода.                                       |
  | Тип ускорения GPU  | Тип ускорения GPU.                                                                                              |
  | Значение ускорения GPU | Значение ускорения GPU.                                                                                             |
  | Временное хранилище      | Временное хранилище, используемое службой вывода.                                                                     |
  | Подключите существующий PVC     | Подключите существующий запрос на постоянный объем Kubernetes (PVC) в качестве хранилища.                                                     |
  | Вместимость               | Обязательно, размер емкости временного хранилища или PVC.                                                                   |
  | Авто масштабирование           | Включите или отключите функциональность автоматического масштабирования.                                                                              |
  | Количество экземпляров    | Обязательно, количество экземпляров, запущенных службой вывода.                                                           |
  | Переменные среды  | Пары ключ-значение, внедренные в среду выполнения контейнера.                                                           |
  | Добавить параметры         | Параметры, передаваемые исполняемому файлу точек входа контейнера. Массив строк (например, \["--port=8080", "--batch\_size=4"]).   |
  | Команда запуска        | Переопределяет инструкцию ENTRYPOINT по умолчанию в изображении контейнера. Исполняемый файл + аргументы (например, \["python", "serve.py"]) |

  ### Шаг 3

  Нажмите кнопку **Опубликовать**, чтобы создать службу вывода.
</Steps>

## Опыт

<Steps>
  ### Шаг 1

  В списке служб **API вывода** нажмите на имя любой **Работающей** службы, чтобы просмотреть ее детали.

  ### Шаг 2

  Нажмите **Опыт**, чтобы открыть панель справа.

  ### Шаг 3

  Задайте вопрос

  - Роль системы

    Определяет цель, тон и операционные ограничения ИИ (например, «Вы полезный помощник, специализирующийся на медицинской информации»).

  - Параметры

    Выберите параметры в зависимости от вашего типа задачи. Обратитесь к описаниям параметров ниже для получения подробной информации.
</Steps>

**Описание параметров для различных типов задач**

**Генерация текста**

*Предустановленные параметры*

| Параметр            | Тип данных | Описание                                                                                                                   |
| -------------------- | --------- | ----------------------------------------------------------------------------------------------------------------------------- |
| `do_sample`          | bool      | Использовать ли выборку; если нет, используется жадный декодер.                                                                     |
| `max_new_tokens`     | int       | Максимальное количество токенов для генерации, игнорируя токены в запросе.                                                      |
| `repetition_penalty` | float     | Штраф за повторение, чтобы контролировать повторяющееся содержание в сгенерированном тексте; 1.0 означает отсутствие повторений, 0 — повторения.            |
| `temperature`        | float     | Степень случайности модели для следующего токена при генерации текста; 1.0 означает высокую случайность, 0 — низкую случайность.             |
| `top_k`              | int       | При расчете вероятностного распределения следующего токена учитывайте только первые k токенов с самой высокой вероятностью. |
| `top_p`              | float     | Контролирует кумулятивное вероятностное распределение, учитываемое моделью при выборе следующего токена.                       |
| `use_cache`          | bool      | Использовать ли промежуточные результаты, вычисленные моделью в процессе генерации.                                |

*Другие параметры*

| Параметр            | Тип данных | Описание                                                                                                                                                                                                                                                                                                                                                                                                    |
| -------------------- | --------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `max_length`         | int       | Максимальное количество сгенерированных токенов. Соответствует количеству токенов в запросе + `max_new_tokens`. Если задан `max_new_tokens`, его действие переопределяется.                                                                                                                                                                                                                  |
| `min_length`         | int       | Минимальное количество сгенерированных токенов. Соответствует количеству токенов в запросе + `min_new_tokens`. Если задан `min_new_tokens`, его действие переопределяется.                                                                                                                                                                                                                  |
| `min_new_tokens`     | int       | Минимальное количество сгенерированных токенов, игнорируя токены в запросе.                                                                                                                                                                                                                                                                                                                                         |
| `early_stop`         | bool      | Контролирует условие остановки для методов с использованием пучков. True: генерация останавливается, когда появляются `num_beams` полные кандидаты. False: применяются эвристики, чтобы остановить генерацию, когда маловероятно найти лучшие кандидаты.                                                                                                                                                                                        |
| `num_beams`          | int       | Число пучков, используемых для поиска по пучкам. 1 означает отсутствие поиска по пучкам.                                                                                                                                                                                                                                                                                                                                                  |
| `max_time`           | int       | Максимальное время, разрешенное на выполнение вычислений, в секундах.                                                                                                                                                                                                                                                                                                                                                   |
| `num_beam_groups`    | int       | Делит `num_beams` на группы, чтобы обеспечить разнообразие между разными группами пучков.                                                                                                                                                                                                                                                                                                                               |
| `diversity_penalty`  | float     | Эффективно, когда включены `num_beam_groups`. Этот параметр применяет штраф за разнообразие между группами, чтобы гарантировать, что контент, создаваемый каждой группой, будет как можно более различным.                                                                                                                                                                                                                         |
| `penalty_alpha`      | float     | Контрастный поиск включен, когда `penalty_alpha` больше 0, а `top_k` больше 1. Чем больше значение `penalty_alpha`, тем сильнее контрастный штраф, и тем более вероятно, что сгенерированный текст будет соответствовать ожиданиям. Если значение `penalty_alpha` установлено слишком большим, это может вызвать слишком однородный сгенерированный текст.                                                              |
| `typical_p`          | float     | Локальная типичность измеряет сходство между условной вероятностью предсказания следующего целевого токена и ожидаемой условной вероятностью предсказания следующего случайного токена с учетом сгенерированного частичного текста. Если установлено число с плавающей запятой меньше 1, будет сохранен наименьший набор локально типичных токенов, чьи вероятности суммируются или превышают `typical_p`. |
| `epsilon_cutoff`     | float     | Если установлено число с плавающей запятой строго между 0 и 1, будут выбраны только токены с условными вероятностями, превышающими `epsilon_cutoff`. Рекомендуемые значения варьируются от 3e-4 до 9e-4, в зависимости от размера модели.                                                                                                                                                                                   |
| `eta_cutoff`         | float     | Выборка по eta является гибридом локальной типичной выборки и выборки по epsilon. Если установлено число с плавающей запятой строго между 0 и 1, токен будет рассматриваться только в том случае, если он больше, чем `eta_cutoff` или sqrt(`eta_cutoff`) \* exp(-entropy(softmax(next\_token\_logits))). Рекомендуемые значения варьируются от 3e-4 до 2e-3, в зависимости от размера модели.                                                           |
| `repetition_penalty` | float     | Параметр для штрафа за повторение. 1.0 означает отсутствие штрафа.                                                                                                                                                                                                                                                                                                                                                        |

Для получения дополнительных параметров, пожалуйста, обратитесь к [Конфигурации параметров генерации текста](https://huggingface.co/docs/transformers/main/en/main_classes/text_generation#transformers.GenerationConfig).

**Генерация изображений из текста**

*Предустановленные параметры*

| Параметр             | Тип данных | Описание                                                                                                       |
| --------------------- | --------- | ----------------------------------------------------------------------------------------------------------------- |
| `num_inference_steps` | int       | Количество шагов денойзинга. Большее количество шагов денойзинга обычно приводит к более качественным изображениям, но медленной выборке. |
| `use_cache`           | bool      | Использовать ли промежуточные результаты, вычисленные моделью в процессе генерации.                    |

*Другие параметры*

| Параметр         | Тип данных         | Описание                                                                                                                                                        |
| ----------------- | ----------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `height`          | int               | Высота сгенерированного изображения в пикселях.                                                                                                                      |
| `width`           | int               | Ширина сгенерированного изображения в пикселях.                                                                                                                       |
| `guidance_scale`  | float             | Используется для регулировки баланса между качеством и разнообразием сгенерированного изображения. Более крупные значения увеличивают разнообразие, но снижают качество; рекомендуемый диапазон от 7 до 8.5. |
| `negative_prompt` | str или List\[str] | Используется для указания, какой контент не должен включаться в генерацию изображения.                                                                                         |

Для получения дополнительных параметров, пожалуйста, обратитесь к [Конфигурации параметров генерации изображений из текста](https://huggingface.co/docs/diffusers/main/en/api/pipelines/stable_diffusion/text2img#diffusers.StableDiffusionPipeline).

**Классификация текста**

*Предустановленные параметры*

| Параметр   | Тип данных | Описание                                                                                                                                                                                    |
| ----------- | --------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `top_k`     | int       | Количество типов меток с наивысшим рейтингом. Если предоставленное число равно None или больше числа доступных меток в конфигурации модели, по умолчанию возвращается количество меток. |
| `use_cache` | bool      | Использовать ли промежуточные результаты, вычисленные моделью в процессе генерации.                                                                                                 |

Для получения дополнительных параметров, пожалуйста, обратитесь к [Конфигурации параметров классификации текста](https://huggingface.co/docs/transformers/v4.36.1/en/main_classes/pipelines#transformers.TextClassificationPipeline.__call__)

##### Дополнительные ссылки

[Конфигурация параметров классификации изображений](https://huggingface.co/docs/transformers/v4.36.1/en/main_classes/pipelines#transformers.ImageClassificationPipeline.__call__)

[Конфигурация параметров разговорного поколения](https://huggingface.co/docs/transformers/v4.36.1/en/main_classes/pipelines#transformers.ConversationalPipeline.__call__)

[Конфигурация параметров суммирования](https://huggingface.co/docs/transformers/v4.36.1/en/main_classes/pipelines#transformers.SummarizationPipeline.__call__)

[Конфигурация параметров перевода](https://huggingface.co/docs/transformers/v4.36.1/en/main_classes/pipelines#transformers.TranslationPipeline.__call__)

[Конфигурация параметров генерации текста в текст](https://huggingface.co/docs/transformers/v4.36.1/en/main_classes/pipelines#transformers.Text2TextGenerationPipeline.__call__)

[Конфигурация параметров генерации изображений из изображений](https://huggingface.co/docs/transformers/v4.36.1/en/main_classes/pipelines#transformers.ImageToImagePipeline.__call__)
