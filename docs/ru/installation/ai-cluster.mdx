---
weight: 30
sourceSHA: 80857500c51f8eaafc7c1dc1f6d6fb8e9b06b8d817be88f55f7ee1904520eaec
---

# Компоненты кластера Alauda AI

## Загрузка

Следующие пакеты оператора необходимо загрузить перед установкой:

1. `Alauda AI Cluster`: Для управления компонентами кластера Alauda AI.
2. `KServeless`: Для управления компонентами `KServe` и `Knative Serving`.

:::info
Эти два пакета оператора можно получить в Портале Клиента.

Пожалуйста, свяжитесь со Службой поддержки клиентов для получения дополнительной информации.
:::

## Загрузка

Необходимо загрузить как `Alauda AI Cluster`, так и `KServeless` на кластер назначения.

<Steps>
  ### Загрузка инструмента violet

  Сначала необходимо загрузить инструмент `violet`, если он не установлен на машине.

  В **Управление платформой** консоли ACP:

  1. Щелкните **Marketplace / Загрузить пакеты**.
  2. Щелкните **Скачать инструмент упаковки и списка**.
  3. Найдите необходимую ОС / архитектуру CPU в разделе **Среда выполнения**.
  4. Щелкните **Загрузить**, чтобы скачать инструмент `violet`.
  5. Выполните команду `chmod +x ${PATH_TO_THE_VIOLET_TOOL}`, чтобы сделать инструмент исполняемым.

  ### Загрузка пакета

  Сохраните следующий скрипт в файл `uploading-ai-cluster-packages.sh`, затем прочитайте комментарии ниже, чтобы обновить переменные окружения для конфигурации в этом скрипте.

  ```bash title=uploading-ai-cluster-packages.sh
  #!/usr/bin/env bash
  export PLATFORM_ADDRESS=https://platform-address  # [!code callout]
  export PLATFORM_ADMIN_USER=<admin>  # [!code callout]
  export PLATFORM_ADMIN_PASSWORD=<admin-password>  # [!code callout]
  export CLUSTER=<cluster-name>  # [!code callout]

  export AI_CLUSTER_OPERATOR_NAME=<path-to-aml-operator-tarball>  # [!code callout]
  export KSERVELESS_OPERATOR_PKG_NAME=<path-to-kserveless-operator-tarball>  # [!code callout]

  VIOLET_EXTRA_ARGS=()
  IS_EXTERNAL_REGISTRY=

  # Если тип реестра изображений кластера назначения не встроенный в платформу (внешний частный или публичный репозиторий).
  # Необходима дополнительная конфигурация (раскомментируйте следующую строку):
  # IS_EXTERNAL_REGISTRY=true
  if [[ "${IS_EXTERNAL_REGISTRY}" == "true" ]]; then
      REGISTRY_URL=<external-registry-url>  # [!code callout]
      REGISTRY_USERNAME=<registry-username>  # [!code callout]
      REGISTRY_PASSWORD=<registry-password>  # [!code callout]

      VIOLET_EXTRA_ARGS+=(
          --dst-repo "${REGISTRY_ADDRESS}"
          --username "${REGISTRY_USERNAME}"
          --password "${REGISTRY_PASSWORD}"
      )
  fi

  # [!code highlight]
  # Отправить пакет оператора **Alauda AI Cluster** на кластер назначения
  violet push \
      ${AI_CLUSTER_OPERATOR_NAME} \
      --platform-address=${PLATFORM_ADDRESS} \
      --platform-username=${PLATFORM_ADMIN_USER} \
      --platform-password=${PLATFORM_ADMIN_PASSWORD} \
      --clusters=${CLUSTER} \
      ${VIOLET_EXTRA_ARGS[@]}

  # [!code highlight]
  # Отправить пакет оператора **KServeless** на кластер назначения
  violet push \
      ${KSERVELESS_OPERATOR_PKG_NAME} \
      --platform-address=${PLATFORM_ADDRESS} \
      --platform-username=${PLATFORM_ADMIN_USER} \
      --platform-password=${PLATFORM_ADMIN_PASSWORD} \
      --clusters=${CLUSTER} \
      ${VIOLET_EXTRA_ARGS[@]}
  ```

  <Callouts>
    1. `${PLATFORM_ADDRESS}` — это адрес вашей платформы ACP.
    2. `${PLATFORM_ADMIN_USER}` — это имя пользователя администратора платформы ACP.
    3. `${PLATFORM_ADMIN_PASSWORD}` — это пароль администратора платформы ACP.
    4. `${CLUSTER}` — это имя кластера, в который необходимо установить компоненты Alauda AI.
    5. `${AI_CLUSTER_OPERATOR_NAME}` — это путь к пакету оператора Alauda AI Cluster tarball.
    6. `${KSERVELESS_OPERATOR_PKG_NAME}` — это путь к пакету оператора KServeless tarball.
    7. `${REGISTRY_ADDRESS}` — это адрес внешнего реестра.
    8. `${REGISTRY_USERNAME}` — это имя пользователя внешнего реестра.
    9. `${REGISTRY_PASSWORD}` — это пароль внешнего реестра.
  </Callouts>

  После конфигурации выполните скрипт с помощью `bash ./uploading-ai-cluster-packages.sh`, чтобы загрузить оба пакета оператора `Alauda AI Cluster` и `KServeless` на кластер назначения.
</Steps>

## Установка оператора Alauda AI Cluster

<Steps>
  ### Процедура

  В **Управление платформой** консоли ACP:

  1. В верхней части консоли в выпадающем списке **Кластер** выберите кластер назначения, в который хотите установить оператор Alauda AI Cluster.

  2. Щелкните **Marketplace / Операторы Hub**.

  3. Выберите **Alauda AI Cluster**, затем щелкните **Установить**.

     Откроется окно **Установка Alauda AI Cluster**.

  4. Затем в окне **Установка Alauda AI Cluster**.

  5. Оставьте **Канал** без изменений.

  6. Проверьте, соответствует ли **Версия** версии **Alauda AI Cluster**, которую вы хотите установить.

  7. Оставьте **Место установки** без изменений, по умолчанию должно быть `aml-operator`.

  8. Выберите **Ручной** для **Стратегии обновления**.

  9. Щелкните **Установить**.

  ### Проверка

  Убедитесь, что плитка **Alauda AI Cluster** отображает одно из следующих состояний:

  - `Устанавливается`: установка в процессе; дождитесь изменения состояния на `Установлено`.
  - `Установлено`: установка завершена.
</Steps>

## Создание экземпляра кластера Alauda AI

После установки оператора Alauda AI Cluster вы можете создать экземпляр кластера Alauda AI.

### Процедура

В **Управление платформой** консоли ACP:

1. В верхней части консоли в выпадающем списке **Кластер** выберите кластер назначения, в который хотите установить оператор Alauda AI Cluster.

2. Щелкните **Marketplace / Операторы Hub**.

3. Выберите **Alauda AI Cluster**, затем щелкните **Щелкнуть**.

4. На странице **Alauda AI Cluster** щелкните **Все экземпляры** на вкладке.

5. Щелкните **Создать экземпляр**.

   Откроется окно **Выбор типа экземпляра**.

6. Найдите плитку **AmlCluster** в окне **Выбор типа экземпляра**, затем щелкните **Создать экземпляр**.

   Появится форма **Создание AmlCluster**.

7. Оставьте `default` без изменений для **Имя**.

8. Выберите **Развернуть Flavor** из выпадающего списка:
   1. `single-node` для обычных развертываний.
   2. `ha-cluster` для развертываний кластера HA (**Рекомендуется** для производства).

9. Выберите **Управляемый** для **Режим Knative Serving**.

10. Выберите **Управляемый** для **Режим KServe**.

11. Введите допустимый домен в поле **Домен**.

    :::info
    Этот домен используется шлюзом входа для предоставления услуг обслуживания моделей.
    Скорее всего, вы захотите использовать имя с подстановочным знаком, например \*.example.com.

    Вы можете указать следующие типы сертификатов, обновив поле **Тип сертификата домена**:

    - `Предоставленный`
    - `Самоподписанный`
    - `ACPDefaultIngress`

    По умолчанию конфигурация использует тип сертификата `Самоподписанный` для защиты входящего трафика в ваш кластер. Сертификат хранится в секрете `knative-serving-cert`, который указан в поле **Секрет сертификата домена**.

    Чтобы использовать сертификат, предоставленный вами, храните секрет сертификата в пространстве имен `istio-system`, затем обновите значение поля **Секрет сертификата домена** и измените значение поля **Секрет сертификата домена** на `Предоставленный`.
    :::

12. В подразделе **Gitlab**:
    1. Введите URL вашего самостоятелльного Gitlab в поле **Базовый URL**.
    2. Введите `cpaas-system` для **Имя секретного ключа администратора**.
    3. Введите `aml-gitlab-admin-token` для **Имя секретного ключа администратора**.

13. В разделе **MySQL**:

    1. Введите *адрес* экземпляра MySQL в поле **Хост**.
    2. Введите *порт* для экземпляра MySQL в поле **Порт** (по умолчанию: `3306`).
    3. Введите *имя пользователя* для подключения к экземпляру MySQL в поле **Имя пользователя**.
    4. Введите *базу данных*, которая будет использоваться для **Alauda AI**, в поле **База данных** (по умолчанию: `aml`).
    5. Выберите пространство имен секретного пароля для *имени пользователя* в поле **Имя пространства секретного пароля**.
    6. Введите имя секрета пароля для *имени пользователя* в поле **Имя секрета пароля**.

    :::info
    **О привилегиях пользователей MySQL**

    - *Имя пользователя* для экземпляра MySQL должно иметь привилегии DDL.
    - Рекомендуется создать *базу данных* и предоставить *пользователю* доступ к *базе данных*.
    - Если *база данных* не создана, *пользователю* потребуются привилегии `CREATE DATABASE`, чтобы создать *базу данных*.
      :::

14. Проверьте вышеуказанные настройки и затем щелкните **Создать**.

### Проверка

Проверьте поле состояния ресурса `AmlCluster`, названного `default`:

```bash
kubectl get amlcluster default
```

Должен вернуться `Готово`:

```
NAME      READY   REASON
default   True    Succeeded
```
